<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Altruelle Academy | 49 CFR §382.603 Training</title>
    <style>
        /* THE SOVEREIGN THEME */
        :root {
            --obsidian: #0a0c12; 
            --glass: rgba(255, 255, 255, 0.03);
            --blue: #4aa7ff; 
            --glow: rgba(74, 167, 255, 0.3);
        }

        body {
            background-color: var(--obsidian);
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden;
        }

        /* COMMAND CENTER HEADER */
        header {
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .status-light {
            width: 10px;
            height: 10px;
            background: var(--blue);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--blue);
            animation: proctorPulse 2s infinite ease-in-out;
        }

        @keyframes proctorPulse {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(74, 167, 255, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(74, 167, 255, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(74, 167, 255, 0); }
        }

        /* THE STAGE: YOUR FIGMA SLIDES */
        .stage-container {
            width: 100%;
            height: calc(100vh - 160px);
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ROADMAP PROGRESS BAR */
        .roadmap-wrapper {
            margin: 10px 0 20px 0;
            padding: 0 20px;
        }
        .roadmap-bar {
            display: flex;
            width: 100%;
            height: 2px;
            background: rgba(255,255,255,0.05);
        }
        .roadmap-seg {
            flex: 1;
            transition: all 1s ease;
        }
        .seg-active {
            background: #4aa7ff;
            box-shadow: 0 0 10px rgba(74, 167, 255, 0.5);
        }
        .roadmap-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-family: monospace;
            font-size: 9px;
            letter-spacing: 0.15em;
            color: rgba(255,255,255,0.3);
        }

        /* 120-MINUTE COMPLIANCE FOOTER */
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            padding: 0 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #0a0e1c;
            border-top: 1px solid rgba(74, 167, 255, 0.2);
            box-sizing: border-box;
            z-index: 999;
        }

        /* FIXED TRAINING MODULE (CENTERED & HIDDEN BY DEFAULT) */
        #training-module {
            display: none; 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            width: 800px; 
            max-width: 90%; 
            max-height: 75vh; 
            background: rgba(10, 14, 28, 0.98); 
            border: 1px solid rgba(74, 167, 255, 0.4); 
            border-radius: 15px; 
            padding: 30px; 
            z-index: 9999; 
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
            overflow-y: auto;
        }

        @keyframes instructorAlert {
    0% { background: rgba(74, 167, 255, 0.1); box-shadow: 0 0 0px var(--blue); }
    50% { background: rgba(74, 167, 255, 0.4); box-shadow: 0 0 15px var(--blue); }
    100% { background: rgba(74, 167, 255, 0.1); box-shadow: 0 0 0px var(--blue); }
}

.assist-pulse {
    animation: instructorAlert 2s infinite ease-in-out;
    border-color: #4affaa !important; /* Green border to signal 'Ready' */
}
    </style>
    
</head>
<body>

    <header>
        <div>
            <span style="letter-spacing: 0.2em; font-size: 11px;">ALTRUELLE ACADEMY</span>
            <h1 style="margin: 5px 0 0 0; font-size: 18px;">DOT Supervisor Training</h1>
        </div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div id="instructor-controls" style="display: none;">
                 <button id="launch-assist-btn" onclick="launchScenario()" style="padding: 5px 12px; background: rgba(74, 167, 255, 0.1); border: 1px solid #4aa7ff; color: #4aa7ff; border-radius: 4px; font-size: 10px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s ease;">
                    Launch Assist
                 </button>
            </div>
            <span style="font-size: 11px; color: var(--blue);">PROCTOR STATUS: ACTIVE</span>
            <div class="status-light"></div>
        </div>
    </header>

    <div class="roadmap-wrapper">
        <div class="roadmap-bar">
            <div id="seg1" class="roadmap-seg seg-active"></div>
            <div id="seg2" class="roadmap-seg"></div>
        </div>
        <div class="roadmap-labels">
            <span>PHASE I: CONTROLLED SUBSTANCES (60M)</span>
            <span>PHASE II: ALCOHOL MISUSE (60M)</span>
        </div>
    </div>

    <div id="instructor-controls-slides" style="display: none;">
    <main class="stage-container">
        <iframe src="https://attic-swoop-68239140.figma.site/"></iframe>
    </main>
</div>

    <footer>
    <div style="display: flex; align-items: center; gap: 20px;">
        <div id="timer" style="font-family: monospace; font-size: 14px; color: var(--blue);">120:00:00</div>
        <a id="claimButton" href="certificate-form.html" style="display: none; text-decoration: none;">
            <button style="cursor:pointer; padding: 8px 12px; border-radius: 6px; border: 1px solid #4affaa; background: rgba(74, 255, 170, 0.1); color: #4affaa; font-size: 11px; text-transform: uppercase;">Claim Certificate</button>
        </a>
        <button onclick="downloadLog()" style="cursor:pointer; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--blue); background: rgba(74, 167, 255, 0.1); color: var(--blue); font-size: 11px; text-transform: uppercase;">
            Download Compliance Log
        </button>
    </div>
    <div style="font-size: 11px; opacity: 0.5;">CERTIFICATION STATUS | 49 CFR §382.603</div>
    <div id="proctor-log" style="font-family: monospace; font-size: 10px; color: rgba(74, 167, 255, 0.7); background: rgba(0,0,0,0.3); padding: 5px 10px; height: 30px; border-left: 1px solid var(--blue); width: 250px; overflow-y: auto;">
        > INITIALIZING...
    </div>
    <div onclick="authorizeInstructor()" style="position: fixed; bottom: 0; right: 0; width: 50px; height: 50px; cursor: pointer; z-index: 99999; background: transparent;"></div>
</footer>

    <div id="training-module">
        <p id="module-tag" style="color: #4aa7ff; font-size: 11px; letter-spacing: 3px; text-transform: uppercase; margin: 0;">MODULE INITIALIZED</p>
        <h2 id="scenario-title" style="color: white; margin: 10px 0; font-size: 22px;"></h2>
        <hr style="border: 0; border-top: 1px solid rgba(74, 167, 255, 0.2); margin: 15px 0;">
        <div id="scenario-text" style="color: rgba(255, 255, 255, 0.95); line-height: 1.7; font-size: 16px; margin-bottom: 25px;"></div>
        <div id="instruction-note" style="font-style: italic; color: #4affaa; font-size: 13px; margin-bottom: 20px;"></div>
        <div style="text-align: right; margin-top: 20px;">
            <button id="next-module-btn" style="display: none; padding: 12px 25px; background: rgba(74, 167, 255, 0.2); border: 1px solid #4aa7ff; color: #4aa7ff; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase;">
                Complete Section
            </button>
        </div>
    </div>

<script>
// 1. DATA & STATE
let timeRemaining = 7200; 
let currentStep = 0;
let canStart = false; 
let traineeValidated = true; 
let isInstructor = false; 

const dotScenarios = [
    { module: "Module 1: Alcohol", title: "Morning Briefing", text: "Driver arrives at 06:00 AM. You notice coordination issues and smell alcohol.", note: "✓ PARTICIPATION: Trainee must confirm presence." },
    { module: "Module 2: Drugs", title: "Post-Rest Stop", text: "Driver returns with dilated pupils and hyper-active speech.", note: "✓ PARTICIPATION: Trainee must confirm presence." },
    { module: "Module 3: Documentation", title: "The Record", text: "You initiated a test. Document observations within 24 hours.", note: "✓ PARTICIPATION: Trainee must confirm presence." },
    { module: "Module 4: Behavior", title: "Slurred Response", text: "Driver’s speech is thick and slurred. Remove from duty immediately.", note: "✓ PARTICIPATION: Trainee must confirm presence." },
    { module: "Module 5: Resolution", title: "Refusal to Test", text: "Driver refuses test. Legally identical to a positive test.", note: "✓ PARTICIPATION: Trainee must confirm presence." }
];

// 2. THE MASTER UNLOCK
function authorizeInstructor() {
    const code = prompt("Enter Altruelle Academy Instructor Code:");
    if (code === "Altruelle2026") {
        isInstructor = true;
        
        // This unlocks your Launch button
        const headerLock = document.getElementById('instructor-controls');
        if (headerLock) headerLock.style.display = "block";
        
        // This unlocks your Figma Lesson Plan
        const mainLock = document.getElementById('instructor-controls-slides');
        if (mainLock) mainLock.style.display = "block";
        
        logMessage("ADMIN AUTHENTICATED: SYSTEM FULLY UNLOCKED");
    } else {
        alert("Access Denied.");
    }
}

// 3. LOGGING & DOWNLOAD
function logMessage(msg) {
    const time = new Date().toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit' });
    const log = document.getElementById('proctor-log');
    if (log) {
        log.innerHTML += `> ${time} : ${msg}<br>`; 
        log.scrollTop = log.scrollHeight; 
    }
}

function downloadLog() {
    const logContent = document.getElementById('proctor-log').innerText;
    const blob = new Blob([logContent], { type: 'text/plain' });
    const anchor = document.createElement('a');
    anchor.download = "Compliance_Log.txt";
    anchor.href = window.URL.createObjectURL(blob);
    anchor.click();
}

// 4. CLOCK
const countdown = setInterval(() => {
    if (!canStart || !traineeValidated) return;
    let hours = Math.floor(timeRemaining / 3600);
    let minutes = Math.floor((timeRemaining % 3600) / 60);
    let seconds = timeRemaining % 60;
    document.getElementById('timer').textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

    if (timeRemaining <= 0) {
        clearInterval(countdown);
        document.getElementById('timer').textContent = "CERTIFICATION ELIGIBLE";
        if (document.getElementById('claimButton')) document.getElementById('claimButton').style.display = "block";
        logMessage("120-MINUTE COMPLIANCE VERIFIED");
    }
    timeRemaining--;
}, 1000);

// 5. MODULES
function launchScenario() {
    if (!isInstructor) return;
    const trainingBox = document.getElementById('training-module');
    if (currentStep < dotScenarios.length) {
        const s = dotScenarios[currentStep];
        document.getElementById('module-tag').innerText = s.module;
        document.getElementById('scenario-title').innerText = s.title;
        document.getElementById('scenario-text').innerText = s.text;
        document.getElementById('instruction-note').innerText = s.note;
        traineeValidated = false; 
        trainingBox.style.display = 'block';
        logMessage(`SCENARIO REVEALED: ${s.title}`);
    }
}

function validateTrainee() {
    traineeValidated = true;
    currentStep++;
    document.getElementById('training-module').style.display = 'none';
    logMessage("PARTICIPATION VERIFIED: RESUMING LECTURE");
}

// 6. INITIALIZING
window.onload = function() {
    canStart = true;
    logMessage("SESSION AUTHENTICATED: MONITORING ACTIVE");
};
</script>

</body>
</html>
