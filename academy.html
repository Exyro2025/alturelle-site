<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Altruelle Academy | 49 CFR §382.603 Training</title>
    <style>
        /* THE SOVEREIGN THEME */
        :root {
            --obsidian: #0a0c12; 
            --glass: rgba(255, 255, 255, 0.03);
            --blue: #4aa7ff; 
            --glow: rgba(74, 167, 255, 0.3);
        }

        body {
            background-color: var(--obsidian);
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden;
        }

        /* COMMAND CENTER HEADER */
        header {
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .status-light {
            width: 10px;
            height: 10px;
            background: var(--blue);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--blue);
            animation: proctorPulse 2s infinite ease-in-out;
        }

        @keyframes proctorPulse {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(74, 167, 255, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(74, 167, 255, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(74, 167, 255, 0); }
        }

        /* THE STAGE: YOUR FIGMA SLIDES */
        .stage-container {
            width: 100%;
            height: calc(100vh - 160px);
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ROADMAP PROGRESS BAR */
        .roadmap-wrapper {
            margin: 10px 0 20px 0;
            padding: 0 20px;
        }
        .roadmap-bar {
            display: flex;
            width: 100%;
            height: 2px;
            background: rgba(255,255,255,0.05);
        }
        .roadmap-seg {
            flex: 1;
            transition: all 1s ease;
        }
        .seg-active {
            background: #4aa7ff;
            box-shadow: 0 0 10px rgba(74, 167, 255, 0.5);
        }
        .roadmap-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-family: monospace;
            font-size: 9px;
            letter-spacing: 0.15em;
            color: rgba(255,255,255,0.3);
        }

        /* 120-MINUTE COMPLIANCE FOOTER */
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            padding: 0 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #0a0e1c;
            border-top: 1px solid rgba(74, 167, 255, 0.2);
            box-sizing: border-box;
            z-index: 999;
        }

        /* FIXED TRAINING MODULE (CENTERED & HIDDEN BY DEFAULT) */
        #training-module {
            display: none; 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            width: 800px; 
            max-width: 90%; 
            max-height: 75vh; 
            background: rgba(10, 14, 28, 0.98); 
            border: 1px solid rgba(74, 167, 255, 0.4); 
            border-radius: 15px; 
            padding: 30px; 
            z-index: 9999; 
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
            overflow-y: auto;
        }

        @keyframes instructorAlert {
    0% { background: rgba(74, 167, 255, 0.1); box-shadow: 0 0 0px var(--blue); }
    50% { background: rgba(74, 167, 255, 0.4); box-shadow: 0 0 15px var(--blue); }
    100% { background: rgba(74, 167, 255, 0.1); box-shadow: 0 0 0px var(--blue); }
}

.assist-pulse {
    animation: instructorAlert 2s infinite ease-in-out;
    border-color: #4affaa !important; /* Green border to signal 'Ready' */
}
    </style>
    
</head>
<body>

    <header>
    <div>
        <span style="letter-spacing: 0.2em; font-size: 11px;">ALTRUELLE ACADEMY</span>
        <h1 style="margin: 5px 0 0 0; font-size: 18px;">DOT Supervisor Training</h1>
    </div>
    <div style="display: flex; align-items: center; gap: 15px;">
        <button id="launch-assist-btn" onclick="launchScenario()" style="padding: 5px 12px; background: rgba(74, 167, 255, 0.1); border: 1px solid #4aa7ff; color: #4aa7ff; border-radius: 4px; font-size: 10px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s ease;">
            Launch Assist
        </button>
        <span style="font-size: 11px; color: var(--blue);">PROCTOR STATUS: ACTIVE</span>
        <div class="status-light"></div>
    </div>
</header>

    <div class="roadmap-wrapper">
        <div class="roadmap-bar">
            <div id="seg1" class="roadmap-seg seg-active"></div>
            <div id="seg2" class="roadmap-seg"></div>
        </div>
        <div class="roadmap-labels">
            <span>PHASE I: CONTROLLED SUBSTANCES (60M)</span>
            <span>PHASE II: ALCOHOL MISUSE (60M)</span>
        </div>
    </div>

    <main class="stage-container">
        <iframe src="https://attic-swoop-68239140.figma.site/"></iframe>
    </main>

    <footer>
    <div style="display: flex; align-items: center; gap: 20px;">
        <div id="timer" style="font-family: monospace; font-size: 14px; color: var(--blue);">120:00:00</div>
        
        <a id="claimButton" href="certificate-form.html" style="display: none; text-decoration: none;">
            <button style="cursor:pointer; padding: 8px 12px; border-radius: 6px; border: 1px solid #4affaa; background: rgba(74, 255, 170, 0.1); color: #4affaa; font-size: 11px; text-transform: uppercase;">Claim Certificate</button>
        </a>

        <button onclick="downloadLog()" style="cursor:pointer; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--blue); background: rgba(74, 167, 255, 0.1); color: var(--blue); font-size: 11px; text-transform: uppercase;">
            Download Compliance Log
        </button>
    </div>

    <div style="font-size: 11px; opacity: 0.5;">CERTIFICATION STATUS | 49 CFR §382.603</div>
    
    <div id="proctor-log" style="font-family: monospace; font-size: 10px; color: rgba(74, 167, 255, 0.7); background: rgba(0,0,0,0.3); padding: 5px 10px; height: 30px; border-left: 1px solid var(--blue); width: 250px; overflow-y: auto;">
        > INITIALIZING...
    </div>
</footer>

    <div id="training-module">
        <p id="module-tag" style="color: #4aa7ff; font-size: 11px; letter-spacing: 3px; text-transform: uppercase; margin: 0;">MODULE INITIALIZED</p>
        <h2 id="scenario-title" style="color: white; margin: 10px 0; font-size: 22px;"></h2>
        <hr style="border: 0; border-top: 1px solid rgba(74, 167, 255, 0.2); margin: 15px 0;">
        <div id="scenario-text" style="color: rgba(255, 255, 255, 0.95); line-height: 1.7; font-size: 16px; margin-bottom: 25px;"></div>
        <div id="instruction-note" style="font-style: italic; color: #4affaa; font-size: 13px; margin-bottom: 20px;"></div>
        <div style="text-align: right; margin-top: 20px;">
            <button id="next-module-btn" style="display: none; padding: 12px 25px; background: rgba(74, 167, 255, 0.2); border: 1px solid #4aa7ff; color: #4aa7ff; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase;">
                Complete Section
            </button>
        </div>
    </div>

    <script>
    
// 1. DATA & STATE
let timeRemaining = 7200; // 120 Minutes
let currentStep = 0;
let canStart = false; 
let traineeValidated = true; 

const dotScenarios = [
    { module: "Module 1: Alcohol Misuse", title: "The Morning Briefing Incident", text: "A driver arrives at 06:00 AM. You notice coordination issues and the faint smell of alcohol.", note: "✓ PARTICIPATION: Trainee must confirm presence to continue." },
    { module: "Module 2: Controlled Substances", title: "The Post-Rest Stop Change", text: "A driver returns with dilated pupils and hyper-active speech patterns.", note: "✓ PARTICIPATION: Trainee must confirm presence to continue." },
    { module: "Module 3: Documentation", title: "The Contemporaneous Record", text: "You have initiated a test. You must now document observations within 24 hours.", note: "✓ PARTICIPATION: Trainee must confirm presence to continue." },
    { module: "Module 4: Speech & Behavior", title: "The Slurred Response", text: "A driver’s speech is thick and slurred. Under DOT rules, you must remove them from duty.", note: "✓ PARTICIPATION: Trainee must confirm presence to continue." },
    { module: "Module 5: Compliance Resolution", title: "Refusal to Test", text: "A driver refuses a test. Under DOT regulations, this is legally identical to a positive test.", note: "✓ PARTICIPATION: Trainee must confirm presence to continue." }
];

function logMessage(msg) {
    const time = new Date().toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit' });
    const log = document.getElementById('proctor-log');
    if (log) {
        // Change '=' to '+=' to keep the history, and add '<br>' for spacing
        log.innerHTML += `> ${time} : ${msg}<br>`; 
        // This ensures the box stays scrolled to the latest message
        log.scrollTop = log.scrollHeight; 
    }
}

// 2. THE FOCUS GUARD (Tab Detection)
document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
        canStart = false; 
        logMessage("SESSION PAUSED: WINDOW FOCUS LOST");
        const light = document.querySelector('.status-light');
        if (light) light.style.background = "#ff4a4a";
    } else if (traineeValidated) {
        canStart = true;
        logMessage("SESSION RESUMED: FOCUS VERIFIED");
        const light = document.querySelector('.status-light');
        if (light) light.style.background = "var(--blue)";
    }
});

// 3. THE COMPLIANCE CLOCK
const countdown = setInterval(() => {
    if (!canStart || !traineeValidated) return;
    
    let hours = Math.floor(timeRemaining / 3600);
    let minutes = Math.floor((timeRemaining % 3600) / 60);
    let seconds = timeRemaining % 60;

    // Instructor Pulse at 10 Minutes
    if (timeRemaining === 6600 && currentStep === 0) {
        const btn = document.getElementById('launch-assist-btn');
        if (btn) btn.classList.add('assist-pulse');
        logMessage("PROCTOR READY: MODULE 1 INITIALIZED");
    }

    document.getElementById('timer').textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

    if (timeRemaining <= 0) {
        clearInterval(countdown);
        document.getElementById('timer').textContent = "CERTIFICATION ELIGIBLE";
        const claim = document.getElementById('claimButton');
        if (claim) claim.style.display = "block";
        logMessage("120-MINUTE COMPLIANCE VERIFIED");
    }
    timeRemaining--;
}, 1000);

// 4. INSTRUCTOR TRIGGER & PARTICIPATION GATES
function launchScenario() {
    if (!canStart) return;
    const trainingBox = document.getElementById('training-module');
    const launchBtn = document.getElementById('launch-assist-btn');
    const nextBtn = document.getElementById('next-module-btn');
    
    if (launchBtn) launchBtn.classList.remove('assist-pulse');

    if (currentStep < dotScenarios.length) {
        const s = dotScenarios[currentStep];
        document.getElementById('module-tag').innerText = s.module;
        document.getElementById('scenario-title').innerText = s.title;
        document.getElementById('scenario-text').innerText = s.text;
        document.getElementById('instruction-note').innerText = s.note;

        // GATE: Pause timer and require check
        traineeValidated = false; 
        if (nextBtn) nextBtn.style.display = 'none';
        trainingBox.style.display = 'block';
        
        const oldCheck = document.getElementById('participation-check');
        if (oldCheck) oldCheck.remove();

        const checkArea = document.createElement('div');
        checkArea.id = "participation-check";
        checkArea.style = "margin-top:20px; padding:15px; background:rgba(74,167,255,0.1); border-radius:8px; border:1px solid var(--blue);";
        checkArea.innerHTML = `<label style="color:#4affaa; font-size:12px; cursor:pointer;"><input type="checkbox" onchange="validateTrainee()" style="margin-right:10px;"> I am present and acknowledge this compliance milestone.</label>`;
        trainingBox.appendChild(checkArea);

        logMessage(`SCENARIO REVEALED: ${s.title}`);
    }
}

function validateTrainee() {
    traineeValidated = true;
    canStart = true;
    const nextBtn = document.getElementById('next-module-btn');
    if (nextBtn) nextBtn.style.display = 'block';
    const check = document.getElementById('participation-check');
    if (check) check.innerHTML = `<span style="color:#4affaa; font-size:12px;">✓ PARTICIPATION VERIFIED. SESSION RESUMED.</span>`;
    logMessage("TRAINEE VERIFIED: PARTICIPATION LOGGED");
}

document.getElementById('next-module-btn').onclick = () => {
    document.getElementById('training-module').style.display = 'none';
    logMessage("INSTRUCTOR RESUMING LECTURE");
};

// 5. THE MASTER HANDOVER (Restored Initializing Screen)
window.onload = function() {
    const intro = document.createElement('div');
    intro.id = "handover-overlay";
    intro.style = "position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(7,9,15,0.98); display:flex; justify-content:center; align-items:center; z-index:10000; text-align:center; padding:40px;";
    intro.innerHTML = `
        <div style="max-width:600px;">
            <p style="color:#4aa7ff; letter-spacing:0.3em; font-size:12px;">SYSTEM INITIALIZING</p>
            <h2 style="font-size:24px; color:white;">ALTRUELLE SOVEREIGN PROCTOR ACTIVE</h2>
            <p style="color:rgba(255,255,255,0.4); font-size:13px;">DOT Compliance Monitor Mode: 49 CFR §382.603</p>
        </div>`;
    document.body.appendChild(intro);

    setTimeout(() => {
        intro.style.display = 'none';
        canStart = true; // The system wakes up after 10 seconds
        logMessage("SESSION AUTHENTICATED: MONITORING ACTIVE");
    }, 10000);
};
</script>


</body>
</html>
